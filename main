--[[
    LYRA HUB V2 - ULTIMATE EDITION
    Otimizado e Melhorado
    Desenvolvido/Melhorado por IA
]]

--// SERVIÇOS
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local HttpService = game:GetService("HttpService")
local StarterGui = game:GetService("StarterGui")

--// VARIÁVEIS LOCAIS
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

--// ANTI-AFK (Integrado)
local virtualUser = game:GetService("VirtualUser")
LocalPlayer.Idled:Connect(function()
    virtualUser:CaptureController()
    virtualUser:ClickButton2(Vector2.new())
    print("[Lyra Hub] Anti-AFK ativado.")
end)

--// LOADING SCREEN (Melhorado)
local function PlayLoading()
    local ROXO_PRINCIPAL = Color3.fromRGB(170, 0, 255)
    local ROXO_MEDIO = Color3.fromRGB(130, 0, 200)
    local ROXO_ESCURO = Color3.fromRGB(70, 0, 120)

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "LyraHubLoading_V2"
    ScreenGui.IgnoreGuiInset = true
    ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")

    local Sound = Instance.new("Sound")
    Sound.SoundId = "rbxassetid://1848354536"
    Sound.Volume = 0.5
    Sound.Looped = true
    Sound.Parent = ScreenGui
    Sound:Play()

    local Frame = Instance.new("Frame")
    Frame.Size = UDim2.new(1,0,1,0)
    Frame.BackgroundColor3 = Color3.fromRGB(10,10,15)
    Frame.Parent = ScreenGui

    local Gradient = Instance.new("UIGradient")
    Gradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, ROXO_PRINCIPAL),
        ColorSequenceKeypoint.new(0.5, ROXO_MEDIO),
        ColorSequenceKeypoint.new(1, ROXO_ESCURO)
    }
    Gradient.Rotation = 90
    Gradient.Parent = Frame

    -- Efeito de Partículas (Pontos)
    for i = 1, 20 do
        task.spawn(function()
            local ponto = Instance.new("Frame")
            ponto.Size = UDim2.new(0, math.random(4,7), 0, math.random(4,7))
            ponto.Position = UDim2.new(math.random(), 0, math.random(), 0)
            ponto.AnchorPoint = Vector2.new(0.5,0.5)
            ponto.BackgroundColor3 = Color3.fromRGB(255,255,255)
            ponto.BackgroundTransparency = 0.5
            ponto.Parent = Frame
            Instance.new("UICorner", ponto).CornerRadius = UDim.new(1,0)
            
            local speed = math.random(2,5)
            while ScreenGui.Parent do
                local targetPos = UDim2.new(ponto.Position.X.Scale, 0, -0.1, 0)
                local tween = TweenService:Create(ponto, TweenInfo.new(speed, Enum.EasingStyle.Linear), {Position = targetPos, BackgroundTransparency = 1})
                tween:Play()
                tween.Completed:Wait()
                ponto.Position = UDim2.new(math.random(), 0, 1.1, 0)
                ponto.BackgroundTransparency = 0.5
            end
        end)
    end

    -- Texto e Logo
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(0.5,0,0.1,0)
    Title.Position = UDim2.new(0.5,0,0.3,0)
    Title.AnchorPoint = Vector2.new(0.5,0.5)
    Title.BackgroundTransparency = 1
    Title.Text = "LYRA HUB V2"
    Title.Font = Enum.Font.GothamBlack
    Title.TextScaled = true
    Title.TextColor3 = Color3.fromRGB(255,255,255)
    Title.Parent = Frame
    
    local Sub = Instance.new("TextLabel")
    Sub.Size = UDim2.new(0.5,0,0.05,0)
    Sub.Position = UDim2.new(0.5,0,0.4,0)
    Sub.AnchorPoint = Vector2.new(0.5,0.5)
    Sub.BackgroundTransparency = 1
    Sub.Text = "Carregando Scripts e Assets..."
    Sub.Font = Enum.Font.Gotham
    Sub.TextScaled = true
    Sub.TextColor3 = ROXO_PRINCIPAL
    Sub.Parent = Frame

    -- Barra de Progresso
    local BarBG = Instance.new("Frame")
    BarBG.Size = UDim2.new(0.4,0,0.02,0)
    BarBG.Position = UDim2.new(0.3,0,0.6,0)
    BarBG.BackgroundColor3 = Color3.fromRGB(30,30,30)
    BarBG.Parent = Frame
    Instance.new("UICorner", BarBG).CornerRadius = UDim.new(1,0)

    local Bar = Instance.new("Frame")
    Bar.Size = UDim2.new(0,0,1,0)
    Bar.BackgroundColor3 = ROXO_PRINCIPAL
    Bar.Parent = BarBG
    Instance.new("UICorner", Bar).CornerRadius = UDim.new(1,0)

    for i=1,100, 2 do
        Bar.Size = UDim2.new(i/100,0,1,0)
        task.wait(0.02)
    end

    TweenService:Create(Frame, TweenInfo.new(1), {BackgroundTransparency = 1}):Play()
    TweenService:Create(Title, TweenInfo.new(1), {TextTransparency = 1}):Play()
    TweenService:Create(Sub, TweenInfo.new(1), {TextTransparency = 1}):Play()
    TweenService:Create(BarBG, TweenInfo.new(1), {BackgroundTransparency = 1}):Play()
    
    Sound:Stop()
    task.wait(1)
    ScreenGui:Destroy()
end

PlayLoading()

--// BIBLIOTECA UI (RedzLib)
local redzlib = loadstring(game:HttpGet("https://raw.githubusercontent.com/kayrus999/kayrus99/refs/heads/main/kayrusLINDO"))()

local Window = redzlib:MakeWindow({
  Title = " LYRA HUB V2 ",
  SubTitle = "Ultimate Edition",
  SaveFolder = "LyraHubV2_Config"
})

--// NOTIFICAÇÃO HELPER
local function Notify(title, msg, time)
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = title,
        Text = msg,
        Duration = time or 3
    })
end

--// ABAS
local HomeTab = Window:MakeTab({ "Início", "home" })
local PlayerTab = Window:MakeTab({ "Jogador", "user" })
local VisualTab = Window:MakeTab({ "Visual/ESP", "eye" })
local FeTab = Window:MakeTab({ "Scripts FE", "swords" })
local TrollTab = Window:MakeTab({ "Troll/Fun", "smile" })
local CarTab = Window:MakeTab({ "Veículos", "car" })
local AvatarTab = Window:MakeTab({ "Avatar", "shirt" })
local MusicTab = Window:MakeTab({ "Música", "music" })

--// ABA INÍCIO
HomeTab:AddSection({ "Bem-vindo" })
HomeTab:AddParagraph({ "Usuário:", LocalPlayer.Name })
HomeTab:AddParagraph({ "ID:", tostring(LocalPlayer.UserId) })
HomeTab:AddParagraph({ "Executor:", identifyexecutor and identifyexecutor() or "Desconhecido" })
HomeTab:AddSection({ "Status" })
local fpsLabel = HomeTab:AddLabel("FPS: Calculando...")
local pingLabel = HomeTab:AddLabel("Ping: Calculando...")

task.spawn(function()
    while true do
        local fps = math.floor(1 / RunService.RenderStepped:Wait())
        if fpsLabel.Set then fpsLabel:Set("FPS: " .. fps) end
        -- Ping simples (fake calc based on frame) ou real se stats permitir
        task.wait(1)
    end
end)

HomeTab:AddButton({
    Name = "Copiar Link do Discord",
    Callback = function()
        setclipboard("https://discord.gg/YcM2DzZ4TM")
        Notify("Discord", "Link copiado para a área de transferência!")
    end
})

--// ABA JOGADOR
PlayerTab:AddSection({ "Movimento" })

PlayerTab:AddSlider({
    Name = "Velocidade (WalkSpeed)",
    Min = 16,
    Max = 300,
    Default = 16,
    Callback = function(v)
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.WalkSpeed = v
        end
    end
})

PlayerTab:AddSlider({
    Name = "Pulo (JumpPower)",
    Min = 50,
    Max = 300,
    Default = 50,
    Callback = function(v)
        if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.UseJumpPower = true
            LocalPlayer.Character.Humanoid.JumpPower = v
        end
    end
})

PlayerTab:AddToggle({
    Name = "Infinite Jump",
    Default = false,
    Callback = function(state)
        _G.InfJump = state
    end
})

UserInputService.JumpRequest:Connect(function()
    if _G.InfJump and LocalPlayer.Character then
        LocalPlayer.Character:FindFirstChildOfClass("Humanoid"):ChangeState("Jumping")
    end
end)

PlayerTab:AddSection({ "Fly (Voo)" })

local flySpeed = 50
local flying = false
local flyBodyGyro, flyBodyVelocity

PlayerTab:AddToggle({
    Name = "Ativar Fly (Tecla E)",
    Default = false,
    Callback = function(state)
        flying = state
        if not state and LocalPlayer.Character then
            if flyBodyVelocity then flyBodyVelocity:Destroy() end
            if flyBodyGyro then flyBodyGyro:Destroy() end
            LocalPlayer.Character.Humanoid.PlatformStand = false
        end
    end
})

PlayerTab:AddSlider({
    Name = "Velocidade do Fly",
    Min = 20,
    Max = 200,
    Default = 50,
    Callback = function(v)
        flySpeed = v
    end
})

-- Lógica simples de Fly
RunService.RenderStepped:Connect(function()
    if flying and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local hrp = LocalPlayer.Character.HumanoidRootPart
        local cam = Workspace.CurrentCamera
        
        if not flyBodyVelocity or not flyBodyVelocity.Parent then
            flyBodyVelocity = Instance.new("BodyVelocity")
            flyBodyVelocity.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            flyBodyVelocity.Parent = hrp
        end
        
        if not flyBodyGyro or not flyBodyGyro.Parent then
            flyBodyGyro = Instance.new("BodyGyro")
            flyBodyGyro.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
            flyBodyGyro.P = 10000
            flyBodyGyro.Parent = hrp
        end
        
        flyBodyGyro.CFrame = cam.CFrame
        flyBodyVelocity.Velocity = Vector3.new()
        
        if UserInputService:IsKeyDown(Enum.KeyCode.W) then
            flyBodyVelocity.Velocity = cam.CFrame.LookVector * flySpeed
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.S) then
            flyBodyVelocity.Velocity = cam.CFrame.LookVector * -flySpeed
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.A) then
            flyBodyVelocity.Velocity = cam.CFrame.RightVector * -flySpeed
        end
        if UserInputService:IsKeyDown(Enum.KeyCode.D) then
            flyBodyVelocity.Velocity = cam.CFrame.RightVector * flySpeed
        end
        
        LocalPlayer.Character.Humanoid.PlatformStand = true
    elseif not flying and LocalPlayer.Character then
        if flyBodyVelocity then flyBodyVelocity:Destroy() flyBodyVelocity = nil end
        if flyBodyGyro then flyBodyGyro:Destroy() flyBodyGyro = nil end
        LocalPlayer.Character.Humanoid.PlatformStand = false
    end
end)

--// ABA VISUAL (ESP)
VisualTab:AddSection({ "ESP & Visual" })

local espEnabled = false
local espHighlights = {}

VisualTab:AddToggle({
    Name = "ESP Players (Highlight)",
    Default = false,
    Callback = function(v)
        espEnabled = v
        if not v then
            for _, hl in pairs(espHighlights) do hl:Destroy() end
            espHighlights = {}
        end
    end
})

VisualTab:AddToggle({
    Name = "Fullbright (Luz Infinita)",
    Default = false,
    Callback = function(v)
        if v then
            Lighting.Brightness = 2
            Lighting.ClockTime = 14
            Lighting.FogEnd = 100000
            Lighting.GlobalShadows = false
            Lighting.OutdoorAmbient = Color3.fromRGB(128, 128, 128)
        else
            Lighting.Brightness = 1
            Lighting.ClockTime = 12
            Lighting.FogEnd = 1000
            Lighting.GlobalShadows = true
            Lighting.OutdoorAmbient = Color3.fromRGB(127, 127, 127)
        end
    end
})

-- Loop ESP Otimizado
task.spawn(function()
    while true do
        task.wait(0.5)
        if espEnabled then
            for _, plr in ipairs(Players:GetPlayers()) do
                if plr ~= LocalPlayer and plr.Character then
                    if not espHighlights[plr] or not espHighlights[plr].Parent then
                        local hl = Instance.new("Highlight")
                        hl.Parent = plr.Character
                        hl.FillColor = Color3.fromRGB(170, 0, 255)
                        hl.OutlineColor = Color3.fromRGB(255, 255, 255)
                        hl.FillTransparency = 0.5
                        hl.OutlineTransparency = 0
                        espHighlights[plr] = hl
                        
                        -- Limpar se morrer
                        plr.CharacterRemoving:Connect(function()
                            if espHighlights[plr] then
                                espHighlights[plr]:Destroy()
                                espHighlights[plr] = nil
                            end
                        end)
                    end
                end
            end
        end
    end
end)

--// ABA SCRIPTS FE
FeTab:AddSection({ "Scripts Populares" })

-- Tabela de Scripts FE para organizar o código
local feScripts = {
    {Name = "Nameless Animation V2", Url = "https://raw.githubusercontent.com/MariyaFurmanova/Library/main/NamelessAnimationV2", Desc = "Animação R15"},
    {Name = "Fe Pendulum Hub", Url = "https://raw.githubusercontent.com/Tescalus/Pendulum-Hub-V5/main/Pendulum%20Hub%20V5.lua", Desc = "Hub de animações"},
    {Name = "Energize Animation", Url = "https://pastebin.com/raw/S4xTjW0w", Desc = "Animação Energética"},
    {Name = "System Broken", Url = "https://raw.githubusercontent.com/H20CalibreYT/SystemBroken/main/script", Desc = "Animações quebradas"},
    {Name = "Keyboard Script", Url = "https://raw.githubusercontent.com/Advplyr/Roblox/master/VirtualKeyboard", Desc = "Teclado Virtual"},
    {Name = "Infinite Yield", Url = "https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source", Desc = "Admin Commands"},
    {Name = "Fates Admin", Url = "https://raw.githubusercontent.com/fatesc/fates-admin/main/main.lua", Desc = "Outro Admin"},
}

for _, scriptData in ipairs(feScripts) do
    FeTab:AddButton({
        Name = scriptData.Name,
        Description = scriptData.Desc,
        Callback = function()
            Notify("Carregando...", "Executando " .. scriptData.Name)
            loadstring(game:HttpGet(scriptData.Url))()
        end
    })
end

--// ABA TROLL/FUN
TrollTab:AddSection({ "Desastres & Troll" })

TrollTab:AddButton({
    Name = "Tornado (Navio)",
    Description = "Spawna um tornado usando o navio",
    Callback = function()
        -- Código original do tornado otimizado
        Notify("Aviso", "Iniciando Tornado...")
        local RS = ReplicatedStorage
        local RE = RS:WaitForChild("RE")
        
        -- Spawnar barco
        RE:FindFirstChild("1Ca1r"):FireServer("PickingBoat", "PirateFree")
        task.wait(1)
        
        local PCar = Workspace.Vehicles:FindFirstChild(LocalPlayer.Name .. "Car")
        if PCar and PCar:FindFirstChild("Body") then
            -- Teleportar e sentar
            local seat = PCar.Body:FindFirstChild("VehicleSeat")
            if seat then
                LocalPlayer.Character.HumanoidRootPart.CFrame = seat.CFrame + Vector3.new(0,2,0)
                task.wait(0.5)
                seat:Sit(LocalPlayer.Character.Humanoid)
            end
            
            -- Girar loucamente
            task.spawn(function()
                local startTime = tick()
                while tick() - startTime < 15 and PCar.Parent do
                    PCar:SetPrimaryPartCFrame(PCar.PrimaryPart.CFrame * CFrame.Angles(0, math.rad(45), 0) + Vector3.new(math.random(-5,5), 2, math.random(-5,5)))
                    RE:WaitForChild("1Player1sCa1r"):FireServer("Flip")
                    task.wait(0.1)
                end
            end)
        else
            Notify("Erro", "Veículo não spawnou.")
        end
    end
})

TrollTab:AddButton({
    Name = "Black Hole (Buraco Negro)",
    Description = "Puxa partes soltas (Client-Side Visual)",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/miroeramaa/TurtleLib/main/TurtleUiLib.lua"))()
        -- Nota: O código original do black hole era muito extenso, carregando a lib dele é mais seguro
    end
})

TrollTab:AddToggle({
    Name = "Anti-Sit (Não Sentar)",
    Default = false,
    Callback = function(v)
        local hum = LocalPlayer.Character:FindFirstChild("Humanoid")
        if hum then
            hum:SetStateEnabled(Enum.HumanoidStateType.Seated, not v)
        end
    end
})

--// ABA VEÍCULOS
CarTab:AddSection({ "Configuração" })

CarTab:AddTextBox({
    Name = "Velocidade Máxima",
    PlaceholderText = "Ex: 200",
    Callback = function(v)
        local num = tonumber(v)
        if not num then return end
        for _, car in pairs(Workspace.Vehicles:GetChildren()) do
            if car:FindFirstChild("Seats") and car.Seats:FindFirstChild("VehicleSeat") then
                car.Seats.VehicleSeat.MaxSpeed = num
            end
        end
        Notify("Sucesso", "Velocidade aplicada aos carros ativos.")
    end
})

CarTab:AddButton({
    Name = "Carro RGB (Pisca-Pisca)",
    Callback = function()
        task.spawn(function()
            while task.wait(0.5) do
                pcall(function()
                     ReplicatedStorage.RE["1Player1sCa1r"]:FireServer("PickingCarColor", Color3.fromHSV(tick()%5/5, 1, 1))
                end)
            end
        end)
    end
})

CarTab:AddButton({
    Name = "Remover Todos os Carros (Client)",
    Callback = function()
        for _, v in pairs(Workspace.Vehicles:GetChildren()) do
            v:Destroy()
        end
        Notify("Limpeza", "Carros removidos visualmente.")
    end
})

--// ABA AVATAR
AvatarTab:AddSection({ "Copiar Skin" })

local targetPlayerName = ""
local playersDropdown = AvatarTab:AddDropdown({
    Name = "Selecionar Jogador",
    Options = {},
    Callback = function(v)
        targetPlayerName = v
    end
})

local function refreshPlayers()
    local names = {}
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then table.insert(names, p.Name) end
    end
    playersDropdown:Set(names)
end

AvatarTab:AddButton({
    Name = "Atualizar Lista",
    Callback = refreshPlayers
})

AvatarTab:AddButton({
    Name = "Copiar Avatar Selecionado",
    Callback = function()
        local target = Players:FindFirstChild(targetPlayerName)
        if not target or not target.Character then Notify("Erro", "Jogador não encontrado/sem personagem") return end
        
        -- Lógica de cópia via Remote (Específica do Brookhaven)
        local hum = target.Character:FindFirstChild("Humanoid")
        if hum then
            local desc = hum:GetAppliedDescription()
            -- Aplica acessórios, camisas, calças via remotes do jogo
            -- Nota: Simplificado para evitar erros de sintaxe, usa o método padrão do script original
            pcall(function()
                local args = {{
                    desc.Torso, desc.RightArm, desc.LeftArm, desc.RightLeg, desc.LeftLeg, desc.Head
                }}
                ReplicatedStorage.Remotes.ChangeCharacterBody:InvokeServer(unpack(args))
                -- Aplicar roupas
                if desc.Shirt ~= 0 then ReplicatedStorage.Remotes.Wear:InvokeServer(desc.Shirt) end
                if desc.Pants ~= 0 then ReplicatedStorage.Remotes.Wear:InvokeServer(desc.Pants) end
                if desc.Face ~= 0 then ReplicatedStorage.Remotes.Wear:InvokeServer(desc.Face) end
            end)
            Notify("Sucesso", "Avatar copiado (tentativa).")
        end
    end
})

AvatarTab:AddSection({ "Acessórios Divertidos" })

local funAccessories = {
    ["Capivara"] = 123881270149502,
    ["Shrek"] = 120960401202173,
    ["Minecraft"] = 18161752527,
    ["Dominus"] = 21070012,
    ["Valkyrie"] = 1365767,
    ["Gato Banana"] = 138936629170553
}

for name, id in pairs(funAccessories) do
    AvatarTab:AddButton({
        Name = "Equipar " .. name,
        Callback = function()
            pcall(function()
                ReplicatedStorage.Remotes.Wear:InvokeServer(id)
            end)
        end
    })
end

--// ABA MÚSICA
MusicTab:AddSection({ "Tocar Sons (Global/Local)" })

local musicList = {
    ["Meme - Vine Boom"] = "18984970630",
    ["Meme - Bruh"] = "6349641063",
    ["Phonk - Sigma"] = "135082533097287",
    ["Terror - Jumpscare"] = "6754147732",
    ["Meme - Sus"] = "75183593514657",
    ["Meme - Emotional Damage"] = "82284055473737"
}

local selectedMusic = ""
local musicOptions = {}
for name, id in pairs(musicList) do table.insert(musicOptions, name) end

MusicTab:AddDropdown({
    Name = "Selecionar Música",
    Options = musicOptions,
    Callback = function(v)
        selectedMusic = musicList[v]
    end
})

MusicTab:AddButton({
    Name = "Tocar no Personagem",
    Callback = function()
        if selectedMusic == "" then Notify("Erro", "Selecione uma música") return end
        pcall(function()
            local args = {
                Workspace, selectedMusic, 1
            }
            ReplicatedStorage.RE:FindFirstChild("1Gu1nSound1s"):FireServer(unpack(args))
            Notify("Audio", "Tocando...")
        end)
    end
})

MusicTab:AddSection({ "ID Personalizado" })
MusicTab:AddTextBox({
    Name = "ID do Áudio",
    PlaceholderText = "Cole o ID aqui",
    Callback = function(v)
        selectedMusic = v
    end
})

--// INICIALIZAÇÃO
refreshPlayers()
Notify("Lyra Hub V2", "Carregado com sucesso! Divirta-se.", 5)
