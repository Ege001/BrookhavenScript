--[[
    LYRA HUB ULTIMATE - Optimized & Expanded
    Geliştirilmiş Versiyon
]]

--// Services //--
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local Lighting = game:GetService("Lighting")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local MarketplaceService = game:GetService("MarketplaceService")
local TextChatService = game:GetService("TextChatService")
local StarterGui = game:GetService("StarterGui")

--// Variables //--
local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

--// Colors //--
local ROXO_PRINCIPAL = Color3.fromRGB(170, 0, 255)
local ROXO_MEDIO = Color3.fromRGB(130, 0, 200)
local ROXO_ESCURO = Color3.fromRGB(70, 0, 120)

--// Loading Screen //--
local function PlayLoading()
    if LocalPlayer.PlayerGui:FindFirstChild("LyraHubLoading") then return end
    
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "LyraHubLoading"
    ScreenGui.IgnoreGuiInset = true
    ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    ScreenGui.ResetOnSpawn = false

    local Sound = Instance.new("Sound")
    Sound.SoundId = "rbxassetid://1848354536"
    Sound.Volume = 1
    Sound.Looped = true
    Sound.Parent = ScreenGui
    Sound:Play()

    local Frame = Instance.new("Frame")
    Frame.Size = UDim2.new(1,0,1,0)
    Frame.BackgroundColor3 = Color3.fromRGB(0,0,0)
    Frame.Parent = ScreenGui

    local Gradient = Instance.new("UIGradient")
    Gradient.Color = ColorSequence.new{
        ColorSequenceKeypoint.new(0, ROXO_PRINCIPAL),
        ColorSequenceKeypoint.new(0.5, ROXO_MEDIO),
        ColorSequenceKeypoint.new(1, ROXO_ESCURO)
    }
    Gradient.Rotation = 90
    Gradient.Parent = Frame

    -- Animasyonlu Noktalar
    for i = 1, 35 do
        local ponto = Instance.new("Frame")
        ponto.Size = UDim2.new(0, math.random(4,7), 0, math.random(4,7))
        ponto.Position = UDim2.new(math.random(), 0, math.random(), 0)
        ponto.AnchorPoint = Vector2.new(0.5,0.5)
        ponto.BackgroundColor3 = ROXO_PRINCIPAL
        ponto.BackgroundTransparency = 0.25
        ponto.Parent = Frame

        Instance.new("UICorner", ponto).CornerRadius = UDim.new(1,0)

        local stroke = Instance.new("UIStroke")
        stroke.Color = ROXO_PRINCIPAL
        stroke.Thickness = 1
        stroke.Transparency = 0.4
        stroke.Parent = ponto

        task.spawn(function()
            while ScreenGui.Parent do
                TweenService:Create(
                    ponto,
                    TweenInfo.new(math.random(2,4), Enum.EasingStyle.Sine, Enum.EasingDirection.InOut),
                    {Size = UDim2.new(0,9,0,9), BackgroundTransparency = 0.05}
                ):Play()
                task.wait(2)
                TweenService:Create(
                    ponto,
                    TweenInfo.new(math.random(2,4), Enum.EasingStyle.Sine, Enum.EasingDirection.InOut),
                    {Size = UDim2.new(0,5,0,5), BackgroundTransparency = 0.35}
                ):Play()
                task.wait(2)
            end
        end)
    end

    -- Başlık ve Bilgiler
    local Title = Instance.new("TextLabel")
    Title.Size = UDim2.new(0.7,0,0.12,0)
    Title.Position = UDim2.new(0.5,0,0.1,0)
    Title.AnchorPoint = Vector2.new(0.5,0)
    Title.BackgroundTransparency = 1
    Title.Text = "LYRA HUB ULTIMATE"
    Title.Font = Enum.Font.GothamBlack
    Title.TextScaled = true
    Title.TextColor3 = ROXO_PRINCIPAL
    Title.Parent = Frame

    local LogoFrame = Instance.new("Frame")
    LogoFrame.Size = UDim2.new(0,110,0,110)
    LogoFrame.Position = UDim2.new(0.5,0,0.35,0)
    LogoFrame.AnchorPoint = Vector2.new(0.5,0.5)
    LogoFrame.BackgroundTransparency = 1
    LogoFrame.Parent = Frame

    local thumb = Players:GetUserThumbnailAsync(LocalPlayer.UserId, Enum.ThumbnailType.AvatarBust, Enum.ThumbnailSize.Size420x420)
    local Avatar = Instance.new("ImageLabel")
    Avatar.Size = UDim2.new(1,0,1,0)
    Avatar.BackgroundTransparency = 1
    Avatar.Image = thumb
    Avatar.Parent = LogoFrame
    Instance.new("UICorner", Avatar).CornerRadius = UDim.new(1,0)
    
    local Stroke = Instance.new("UIStroke")
    Stroke.Thickness = 3
    Stroke.Color = ROXO_PRINCIPAL
    Stroke.Parent = Avatar

    -- Loading Bar
    local BarBG = Instance.new("Frame")
    BarBG.Size = UDim2.new(0.6,0,0.05,0)
    BarBG.Position = UDim2.new(0.2,0,0.8,0)
    BarBG.BackgroundColor3 = ROXO_ESCURO
    BarBG.Parent = Frame
    Instance.new("UICorner", BarBG).CornerRadius = UDim.new(0.3,0)

    local Bar = Instance.new("Frame")
    Bar.Size = UDim2.new(0,0,1,0)
    Bar.BackgroundColor3 = ROXO_PRINCIPAL
    Bar.Parent = BarBG
    Instance.new("UICorner", Bar).CornerRadius = UDim.new(0.3,0)

    local Percent = Instance.new("TextLabel")
    Percent.Size = UDim2.new(0.6,0,0.05,0)
    Percent.Position = UDim2.new(0.2,0,0.87,0)
    Percent.BackgroundTransparency = 1
    Percent.Text = "0%"
    Percent.Font = Enum.Font.GothamBold
    Percent.TextScaled = true
    Percent.TextColor3 = Color3.new(1,1,1)
    Percent.Parent = Frame

    -- Loading Animation
    for i=1,100 do
        Bar.Size = UDim2.new(i/100,0,1,0)
        Percent.Text = i.."%"
        task.wait(0.02) -- Hızlandırıldı
    end

    task.wait(0.2)
    Sound:Stop()
    ScreenGui:Destroy()
end

PlayLoading()

--// Library Load //--
local redzlib = loadstring(game:HttpGet("https://raw.githubusercontent.com/kayrus999/kayrus99/refs/heads/main/kayrusLINDO"))()

local Window = redzlib:MakeWindow({
  Title = " LYRA HUB ULTIMATE ",
  SubTitle = "Remake & Optimized",
  SaveFolder = "LyraHub_Ultimate_Cfg"
})

--// Helper Functions //--
local function Notification(title, text, time)
    StarterGui:SetCore("SendNotification", {
        Title = title;
        Text = text;
        Duration = time or 3;
    })
end

local function GetCharacter()
    return LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
end

local function GetRoot()
    local char = GetCharacter()
    return char:WaitForChild("HumanoidRootPart", 5)
end

local function GetHumanoid()
    local char = GetCharacter()
    return char:WaitForChild("Humanoid", 5)
end

--// TABS //--

-- [TAB 1: INFO]
local infoTab = Window:MakeTab({ "Informaçoes", "info" })

infoTab:AddSection({ "Status" })

local function createInfoBlock(tab, title, initial)
    local block
    pcall(function() block = tab:AddParagraph({ Title = title, Content = initial }) end)
    return block
end

local function setBlockText(block, title, text)
    if not block then return end
    pcall(function()
        if block.SetDesc then block:SetDesc(text) end
    end)
end

local fpsBlock     = createInfoBlock(infoTab, "FPS:", "Calculating...")
local pingBlock    = createInfoBlock(infoTab, "Ping:", "Calculating...")
local timeBlock    = createInfoBlock(infoTab, "Tempo Jogado:", "00:00:00")

local startTime = os.clock()

task.spawn(function()
    while true do
        task.wait(1)
        -- FPS
        local fps = math.floor(workspace:GetRealPhysicsFPS())
        setBlockText(fpsBlock, "FPS:", tostring(fps))
        
        -- Ping
        local ping = 0
        pcall(function() ping = tonumber(string.format("%.0f", LocalPlayer:GetNetworkPing() * 2000)) end) -- Approximation
        setBlockText(pingBlock, "Ping:", tostring(ping) .. " ms")
        
        -- Time
        local e = os.clock() - startTime
        local h = math.floor(e/3600)
        local m = math.floor((e%3600)/60)
        local s = math.floor(e%60)
        setBlockText(timeBlock, "Tempo Jogado:", string.format("%02d:%02d:%02d", h, m, s))
    end
end)

infoTab:AddButton({
    Name = "Copiar Link Discord",
    Callback = function()
        setclipboard("https://discord.gg/YcM2DzZ4TM")
        Notification("Lyra Hub", "Discord Linki Kopyalandı!", 3)
    end
})

-- [TAB 2: PLAYER]
local PlayerTab = Window:MakeTab({
    Title = "Player",
    Icon = "rbxassetid://17132521951"
})

PlayerTab:AddSection({ "Movimento" })

PlayerTab:AddSlider({
    Name = "WalkSpeed",
    Min = 16,
    Max = 300,
    Default = 16,
    Callback = function(v)
        local hum = GetHumanoid()
        if hum then hum.WalkSpeed = v end
    end
})

PlayerTab:AddSlider({
    Name = "JumpPower",
    Min = 50,
    Max = 300,
    Default = 50,
    Callback = function(v)
        local hum = GetHumanoid()
        if hum then hum.JumpPower = v end
    end
})

-- Flight Logic
local flightEnabled = false
local flightSpeed = 50
local bv, bg

PlayerTab:AddToggle({
    Name = "Fly (Voo)",
    Default = false,
    Callback = function(state)
        flightEnabled = state
        local root = GetRoot()
        local hum = GetHumanoid()
        
        if state and root and hum then
            bv = Instance.new("BodyVelocity")
            bv.Velocity = Vector3.new(0,0,0)
            bv.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            bv.Parent = root
            
            bg = Instance.new("BodyGyro")
            bg.P = 9e4
            bg.MaxTorque = Vector3.new(9e9, 9e9, 9e9)
            bg.CFrame = root.CFrame
            bg.Parent = root
            
            hum.PlatformStand = true
            
            task.spawn(function()
                while flightEnabled and root and hum do
                    local cam = Workspace.CurrentCamera
                    local moveDir = Vector3.new(0,0,0)
                    
                    if UserInputService:IsKeyDown(Enum.KeyCode.W) then moveDir = moveDir + cam.CFrame.LookVector end
                    if UserInputService:IsKeyDown(Enum.KeyCode.S) then moveDir = moveDir - cam.CFrame.LookVector end
                    if UserInputService:IsKeyDown(Enum.KeyCode.A) then moveDir = moveDir - cam.CFrame.RightVector end
                    if UserInputService:IsKeyDown(Enum.KeyCode.D) then moveDir = moveDir + cam.CFrame.RightVector end
                    if UserInputService:IsKeyDown(Enum.KeyCode.Space) then moveDir = moveDir + Vector3.new(0,1,0) end
                    if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then moveDir = moveDir - Vector3.new(0,1,0) end
                    
                    bv.Velocity = moveDir * flightSpeed
                    bg.CFrame = cam.CFrame
                    task.wait()
                end
            end)
        else
            if bv then bv:Destroy() end
            if bg then bg:Destroy() end
            if hum then hum.PlatformStand = false end
        end
    end
})

PlayerTab:AddSlider({
    Name = "Fly Speed",
    Min = 10,
    Max = 200,
    Default = 50,
    Callback = function(v)
        flightSpeed = v
    end
})

-- Noclip Logic
local noclip = false
PlayerTab:AddToggle({
    Name = "Noclip",
    Default = false,
    Callback = function(v)
        noclip = v
    end
})

RunService.Stepped:Connect(function()
    if noclip and LocalPlayer.Character then
        for _, v in ipairs(LocalPlayer.Character:GetDescendants()) do
            if v:IsA("BasePart") and v.CanCollide == true then
                v.CanCollide = false
            end
        end
    end
end)

PlayerTab:AddButton({
    Name = "Inf Jump",
    Callback = function()
        UserInputService.JumpRequest:Connect(function()
            local hum = GetHumanoid()
            if hum then hum:ChangeState(Enum.HumanoidStateType.Jumping) end
        end)
        Notification("Lyra Hub", "Infinite Jump Ativado!", 2)
    end
})

-- [TAB 3: TELEPORTS (NEW)]
local TpTab = Window:MakeTab({
    Title = "Teleportes",
    Icon = "rbxassetid://10884457088"
})

local function TP(cframe)
    local root = GetRoot()
    if root then
        root.CFrame = cframe
    end
end

TpTab:AddSection({ "Locais Brookhaven" })

-- Koordinatlar tahmini ve güvenli yüksekliktedir
TpTab:AddButton({ Name = "Spawn", Callback = function() TP(CFrame.new(0, 5, 0)) end })
TpTab:AddButton({ Name = "Okul", Callback = function() TP(CFrame.new(-330, 20, 470)) end })
TpTab:AddButton({ Name = "Banka (Kasa)", Callback = function() TP(CFrame.new(30, 20, 420)) end })
TpTab:AddButton({ Name = "Polis Merkezi", Callback = function() TP(CFrame.new(120, 20, 420)) end })
TpTab:AddButton({ Name = "Hastane", Callback = function() TP(CFrame.new(130, 20, -50)) end })
TpTab:AddButton({ Name = "Mezarlık", Callback = function() TP(CFrame.new(150, 20, 780)) end })
TpTab:AddButton({ Name = "Yat (Boat)", Callback = function() TP(CFrame.new(-70, 15, -730)) end })

TpTab:AddSection({ "Araçlar" })
TpTab:AddButton({
    Name = "Tıklayarak TP (Ctrl + Click)",
    Callback = function()
        local mouse = LocalPlayer:GetMouse()
        mouse.Button1Down:Connect(function()
            if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
                TP(CFrame.new(mouse.Hit.p + Vector3.new(0, 3, 0)))
            end
        end)
        Notification("TP", "CTRL basılı tutup tıklayın.", 3)
    end
})

-- [TAB 4: FUN & TROLL]
local FunTab = Window:MakeTab({"Fun & Troll", "rbxassetid://105212753583689"})

FunTab:AddSection({ "Troll" })

FunTab:AddButton({
    Name = "Fling (Döndürerek Fırlat)",
    Callback = function()
        local root = GetRoot()
        local hum = GetHumanoid()
        if not root then return end
        
        local bav = Instance.new("BodyAngularVelocity")
        bav.MaxTorque = Vector3.new(math.huge,math.huge,math.huge)
        bav.AngularVelocity = Vector3.new(0, 10000, 0)
        bav.Parent = root
        
        Notification("Fling", "Yakındaki oyunculara dokun!", 3)
        
        -- 5 saniye sonra kapat
        task.delay(5, function()
            bav:Destroy()
            bav = nil
            if root then root.RotVelocity = Vector3.new(0,0,0) end
        end)
    end
})

FunTab:AddButton({
    Name = "Invisible (Görünmezlik - FE)",
    Callback = function()
        -- Basit FE Görünmezlik mantığı (LowerTorso yok etme)
        local char = GetCharacter()
        if char:FindFirstChild("LowerTorso") then
            char.LowerTorso:Destroy()
            Notification("Invis", "Görünmezlik Aktif (Reset atana kadar)", 3)
        else
             Notification("Invis", "Zaten görünmez veya R6 avatar.", 3)
        end
    end
})

FunTab:AddSection({ "FE Scriptleri" })

FunTab:AddButton({
    Name = "Nameless Animation V3",
    Callback = function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Miztiny/Nameless-Animation-V3/main/Source"))()
    end
})

FunTab:AddButton({
    Name = "Enerji Kılıcı",
    Callback = function()
         -- ReplicatedStorage eventlerini kullanarak tool alma (Orijinal scriptten)
         local args = {
            [1] = "AcceptedToolToServer",
            [2] = "Scythe",
            [3] = LocalPlayer
        }
        pcall(function()
            ReplicatedStorage.RE:FindFirstChild("1Playe1rTrigge1rEven1t"):FireServer(unpack(args))
        end)
    end
})

-- [TAB 5: CAR (ARAÇ)]
local CarTab = Window:MakeTab({"Veiculo", "car"})

CarTab:AddSection({ "Modifikasyonlar" })

local carSpeed = 200
CarTab:AddTextBox({
    Name = "Hız (MaxSpeed)",
    Default = "200",
    TextDisappear = false,
    Callback = function(v)
        carSpeed = tonumber(v) or 200
    end
})

CarTab:AddButton({
    Name = "Hızı Uygula (Tüm Araçlar)",
    Callback = function()
        for _, vehicle in pairs(workspace.Vehicles:GetChildren()) do
            local seat = vehicle:FindFirstChild("Seats") and vehicle.Seats:FindFirstChild("VehicleSeat")
            if seat then
                pcall(function() seat.MaxSpeed = carSpeed end)
                -- Eğer Value varsa onu da değiştir
                if seat:FindFirstChild("MaxSpeed") then seat.MaxSpeed.Value = carSpeed end
            end
        end
        Notification("Car", "Hız uygulandı: " .. carSpeed, 2)
    end
})

CarTab:AddToggle({
    Name = "Araç Uçurma (Car Fly)",
    Default = false,
    Callback = function(state)
        -- Araç uçurma mantığı
        _G.CarFly = state
        task.spawn(function()
            while _G.CarFly do
                local char = LocalPlayer.Character
                if char then
                    local hum = char:FindFirstChild("Humanoid")
                    local seat = hum and hum.SeatPart
                    if seat and seat:IsA("VehicleSeat") then
                        local vehicle = seat.Parent.Parent -- Genelde yapı böyledir
                        local root = seat
                        
                        local cam = Workspace.CurrentCamera
                        local bv = root:FindFirstChild("CarFlyVel") or Instance.new("BodyVelocity", root)
                        bv.Name = "CarFlyVel"
                        bv.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
                        bv.Velocity = Vector3.new(0,0,0)
                        
                        local bg = root:FindFirstChild("CarFlyGyro") or Instance.new("BodyGyro", root)
                        bg.Name = "CarFlyGyro"
                        bg.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
                        bg.P = 10000
                        bg.CFrame = cam.CFrame
                        
                        local speed = 100
                        local vel = Vector3.new(0,0,0)
                         if UserInputService:IsKeyDown(Enum.KeyCode.W) then vel = vel + cam.CFrame.LookVector end
                        if UserInputService:IsKeyDown(Enum.KeyCode.S) then vel = vel - cam.CFrame.LookVector end
                        
                        bv.Velocity = vel * speed
                    else
                        -- Araçta değilse temizle
                    end
                end
                task.wait()
            end
            -- Döngü biterse temizle
             for _, v in pairs(workspace.Vehicles:GetDescendants()) do
                if v.Name == "CarFlyVel" or v.Name == "CarFlyGyro" then v:Destroy() end
            end
        end)
    end
})

-- [TAB 6: MISC (DİĞER)]
local MiscTab = Window:MakeTab({ "Diğer", "settings" })

MiscTab:AddSection({ "Sunucu İşlemleri" })

MiscTab:AddButton({
    Name = "Rejoin (Tekrar Katıl)",
    Callback = function()
        TeleportService:Teleport(game.PlaceId, LocalPlayer)
    end
})

MiscTab:AddButton({
    Name = "Server Hop (Başka Sunucuya Git)",
    Callback = function()
        local Servers = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/"..game.PlaceId.."/servers/Public?sortOrder=Asc&limit=100"))
        for _, v in ipairs(Servers.data) do
            if v.playing ~= v.maxPlayers then
                TeleportService:TeleportToPlaceInstance(game.PlaceId, v.id, LocalPlayer)
                break
            end
        end
    end
})

MiscTab:AddSection({ "Performans" })

MiscTab:AddButton({
    Name = "FPS Boost (Low GFX)",
    Callback = function()
        local decalsyeeted = true
        local g = game
        local w = g.Workspace
        local l = g.Lighting
        local t = g.Workspace.Terrain
        t.WaterWaveSize = 0
        t.WaterWaveSpeed = 0
        t.WaterReflectance = 0
        t.WaterTransparency = 0
        l.GlobalShadows = false
        l.FogEnd = 9e9
        l.Brightness = 0
        settings().Rendering.QualityLevel = "Level01"
        for i, v in pairs(g:GetDescendants()) do
            if v:IsA("Part") or v:IsA("Union") or v:IsA("CornerWedgePart") or v:IsA("TrussPart") then
                v.Material = "Plastic"
                v.Reflectance = 0
            elseif v:IsA("Decal") or v:IsA("Texture") and decalsyeeted then
                v.Transparency = 1
            elseif v:IsA("ParticleEmitter") or v:IsA("Trail") then
                v.Lifetime = NumberRange.new(0)
            end
        end
        Notification("System", "FPS Boost Aktif!", 3)
    end
})

MiscTab:AddButton({
    Name = "Tam Aydınlık (Fullbright)",
    Callback = function()
        Lighting.Brightness = 2
        Lighting.ClockTime = 14
        Lighting.FogEnd = 100000
        Lighting.GlobalShadows = false
        Lighting.OutdoorAmbient = Color3.fromRGB(128, 128, 128)
    end
})

-- [TAB 7: ESP]
local EspTab = Window:MakeTab({ "ESP", "eye" })

_G.ESPEnabled = false
local espFolder = Instance.new("Folder", game.CoreGui)
espFolder.Name = "LyraESP"

local function UpdateESP()
    espFolder:ClearAllChildren()
    if not _G.ESPEnabled then return end
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local highlight = Instance.new("Highlight")
            highlight.Parent = espFolder
            highlight.Adornee = player.Character
            highlight.FillColor = ROXO_PRINCIPAL
            highlight.OutlineColor = Color3.new(1,1,1)
            highlight.FillTransparency = 0.5
            highlight.OutlineTransparency = 0
            
            -- İsim
            local bg = Instance.new("BillboardGui", player.Character.Head)
            bg.Size = UDim2.new(0, 200, 0, 50)
            bg.StudsOffset = Vector3.new(0, 3, 0)
            bg.AlwaysOnTop = true
            
            local txt = Instance.new("TextLabel", bg)
            txt.Size = UDim2.new(1,0,1,0)
            txt.BackgroundTransparency = 1
            txt.Text = player.Name
            txt.TextColor3 = Color3.new(1,1,1)
            txt.TextStrokeTransparency = 0
            txt.Font = Enum.Font.GothamBold
            txt.TextSize = 14
        end
    end
end

EspTab:AddToggle({
    Name = "ESP Player (Kutu + İsim)",
    Default = false,
    Callback = function(state)
        _G.ESPEnabled = state
        if state then
            UpdateESP()
            -- Oyuncu girince/çıkınca yenile
             Players.PlayerAdded:Connect(UpdateESP)
             Players.PlayerRemoving:Connect(UpdateESP)
             -- Döngü (Character yenilenmesi için)
             task.spawn(function()
                 while _G.ESPEnabled do
                     UpdateESP()
                     task.wait(5)
                 end
             end)
        else
            espFolder:ClearAllChildren()
        end
    end
})

--// FINAL NOTIFICATION //--
Notification("Lyra Hub", "Script Yüklendi! İyi Eğlenceler.", 5)
